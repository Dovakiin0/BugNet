import{f as de,j as e,c as v,a as ue,r as n,b as I,m as Ae,u as Me,o as Fe,d as Re,g as Be,A as We,P as $e,e as He,F as c,T as m,h as pe,N as V,O as Qe,L as Ve}from"./index-a26ad9e4.js";import{u as qe,a as Ue,b as Y,c as $,I as ie,d as he,L as ge,e as me,f as fe,F as Ge,g as Ye,h as Ke}from"./useBugs-5a9ccc2e.js";import{a as Z,u as Xe}from"./axios-33fc3c8b.js";import{u as Ze,a as xe,l as Je,A as je}from"./index-0e8350a6.js";import{u as J}from"./useToast-05f70ec3.js";import{h as et,E as ve}from"./Empty-c102110e.js";import{G as ye,F as tt,D as rt,a as ot,b as st,c as nt,d as it,e as at}from"./index.esm-c5e417dc.js";import{u as ct,a as lt,M as be,b as we,c as Se,d as ae,T as dt,N as ce}from"./NormalTextField-fbe2487c.js";import{B as H}from"./chunk-6CSUKJP7-66c8703c.js";import{u as ut,a as pt}from"./useProject-058bd194.js";import{S as Ce,a as ht}from"./Skeleton-6487c1d4.js";import{m as gt,F as mt,c as ft,a as le,b as xt,T as jt,B as ke}from"./TextField-1185120d.js";import{I as vt}from"./chunk-E77276RR-ba875d3c.js";var yt={"top-start":{top:"0",insetStart:"0",transform:"translate(-25%, -25%)"},"top-end":{top:"0",insetEnd:"0",transform:"translate(25%, -25%)"},"bottom-start":{bottom:"0",insetStart:"0",transform:"translate(-25%, 25%)"},"bottom-end":{bottom:"0",insetEnd:"0",transform:"translate(25%, 25%)"}},Pe=de(function(t,o){const{placement:s="bottom-end",className:i,...l}=t,p=Ze(),g={position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",...yt[s],...p.badge};return e.jsx(v.div,{ref:o,...l,className:ue("chakra-avatar__badge",i),__css:g})});Pe.displayName="AvatarBadge";var ee=v("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});ee.displayName="Spacer";var Te=r=>{const{className:t,...o}=r,s=ct();return e.jsx(v.hr,{"aria-orientation":"horizontal",className:ue("chakra-menu__divider",t),...o,__css:s.divider})};Te.displayName="MenuDivider";var bt={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},Q=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},X=r=>{var t,o;return((o=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:o.defaultView)||window};function wt(r={}){const{openDelay:t=0,closeDelay:o=0,closeOnClick:s=!0,closeOnMouseDown:i,closeOnScroll:l,closeOnPointerDown:p=i,closeOnEsc:h=!0,onOpen:g,onClose:w,placement:f,id:d,isOpen:x,defaultIsOpen:k,arrowSize:y=10,arrowShadowColor:P,arrowPadding:q,modifiers:U,isDisabled:T,gutter:_,offset:S,direction:G,...N}=r,{isOpen:u,onOpen:O,onClose:E}=qe({isOpen:x,defaultIsOpen:k,onOpen:g,onClose:w}),{referenceRef:A,getPopperProps:b,getArrowInnerProps:Ne,getArrowProps:Oe}=Ue({enabled:u,placement:f,arrowPadding:q,modifiers:U,gutter:_,offset:S,direction:G}),Ee=n.useId(),M=`tooltip-${d??Ee}`,C=n.useRef(null),z=n.useRef(),L=n.useCallback(()=>{z.current&&(clearTimeout(z.current),z.current=void 0)},[]),F=n.useRef(),R=n.useCallback(()=>{F.current&&(clearTimeout(F.current),F.current=void 0)},[]),B=n.useCallback(()=>{R(),E()},[E,R]),re=St(C,B),W=n.useCallback(()=>{if(!T&&!z.current){re();const a=X(C);z.current=a.setTimeout(O,t)}},[re,T,O,t]),j=n.useCallback(()=>{L();const a=X(C);F.current=a.setTimeout(B,o)},[o,B,L]),oe=n.useCallback(()=>{u&&s&&j()},[s,j,u]),se=n.useCallback(()=>{u&&p&&j()},[p,j,u]),Le=n.useCallback(a=>{u&&a.key==="Escape"&&j()},[u,j]);Y(()=>Q(C),"keydown",h?Le:void 0),Y(()=>Q(C),"scroll",()=>{u&&l&&B()}),n.useEffect(()=>{T&&(L(),u&&E())},[T,u,E,L]),n.useEffect(()=>()=>{L(),R()},[L,R]),Y(()=>C.current,"pointerleave",j);const _e=n.useCallback((a={},D=null)=>({...a,ref:gt(C,D,A),onPointerEnter:I(a.onPointerEnter,Ie=>{Ie.pointerType!=="touch"&&W()}),onClick:I(a.onClick,oe),onPointerDown:I(a.onPointerDown,se),onFocus:I(a.onFocus,W),onBlur:I(a.onBlur,j),"aria-describedby":u?M:void 0}),[W,j,se,u,M,oe,A]),ze=n.useCallback((a={},D=null)=>b({...a,style:{...a.style,[$.arrowSize.var]:y?`${y}px`:void 0,[$.arrowShadowColor.var]:P}},D),[b,y,P]),De=n.useCallback((a={},D=null)=>{const ne={...a.style,position:"relative",transformOrigin:$.transformOrigin.varRef};return{ref:D,...N,...a,id:M,role:"tooltip",style:ne}},[N,M]);return{isOpen:u,show:W,hide:j,getTriggerProps:_e,getTooltipProps:De,getTooltipPositionerProps:ze,getArrowProps:Oe,getArrowInnerProps:Ne}}var K="chakra-ui:close-tooltip";function St(r,t){return n.useEffect(()=>{const o=Q(r);return o.addEventListener(K,t),()=>o.removeEventListener(K,t)},[t,r]),()=>{const o=Q(r),s=X(r);o.dispatchEvent(new s.CustomEvent(K))}}function Ct(r,t=[]){const o=Object.assign({},r);for(const s of t)s in o&&delete o[s];return o}function kt(r,t){const o={};for(const s of t)s in r&&(o[s]=r[s]);return o}var Pt=v(Ae.div),te=de((r,t)=>{var o,s;const i=Me("Tooltip",r),l=Fe(r),p=Re(),{children:h,label:g,shouldWrapChildren:w,"aria-label":f,hasArrow:d,bg:x,portalProps:k,background:y,backgroundColor:P,bgColor:q,motionProps:U,...T}=l,_=(s=(o=y??P)!=null?o:x)!=null?s:q;if(_){i.bg=_;const b=Be(p,"colors",_);i[$.arrowBg.var]=b}const S=wt({...T,direction:p.direction}),G=typeof h=="string"||w;let N;if(G)N=e.jsx(v.span,{display:"inline-block",tabIndex:0,...S.getTriggerProps(),children:h});else{const b=n.Children.only(h);N=n.cloneElement(b,S.getTriggerProps(b.props,b.ref))}const u=!!f,O=S.getTooltipProps({},t),E=u?Ct(O,["role","id"]):O,A=kt(O,["role","id"]);return g?e.jsxs(e.Fragment,{children:[N,e.jsx(We,{children:S.isOpen&&e.jsx($e,{...k,children:e.jsx(v.div,{...S.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:e.jsxs(Pt,{variants:bt,initial:"exit",animate:"enter",exit:"exit",...U,...E,__css:i,children:[g,u&&e.jsx(v.span,{srOnly:!0,...A,children:f}),d&&e.jsx(v.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:e.jsx(v.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):e.jsx(e.Fragment,{children:h})});te.displayName="Tooltip";async function Tt(){try{const{data:r}=await Z.get("/api/v1/auth/@me",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return r}catch(r){return r.response}}const Nt=()=>xe(["auth"],()=>Tt()),Ot=[{name:"Home",path:"/",access:["admin","user"]},{name:"Kanban",path:"/kanban",access:["admin","user"]}];function Et(r){return ye({tag:"svg",attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7816 4.03157C12.0062 3.80702 12.0062 3.44295 11.7816 3.2184C11.5571 2.99385 11.193 2.99385 10.9685 3.2184L7.50005 6.68682L4.03164 3.2184C3.80708 2.99385 3.44301 2.99385 3.21846 3.2184C2.99391 3.44295 2.99391 3.80702 3.21846 4.03157L6.68688 7.49999L3.21846 10.9684C2.99391 11.193 2.99391 11.557 3.21846 11.7816C3.44301 12.0061 3.80708 12.0061 4.03164 11.7816L7.50005 8.31316L10.9685 11.7816C11.193 12.0061 11.5571 12.0061 11.7816 11.7816C12.0062 11.557 12.0062 11.193 11.7816 10.9684L8.31322 7.49999L11.7816 4.03157Z",fill:"currentColor"}}]})(r)}async function Lt(){const{data:r}=await Z.get("/api/v1/notification",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return r}async function _t(r){const{data:t}=await Z.post(`/api/v1/notification/${r}`,{},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return t}const zt=()=>xe(["notification"],Lt),Dt=()=>{const r=He();return Xe(_t,{onSuccess:()=>{Promise.all([r.invalidateQueries(["project"]),r.invalidateQueries(["notification"])])}})};function It({user:r}){let[t,o]=n.useState([]);const{data:s,isSuccess:i,isLoading:l}=zt(),p=Dt(),h=lt();let g=null;const{successToast:w}=J();n.useEffect(()=>{i&&o(s)},[i,l]),n.useEffect(()=>{g=Je("ws://localhost:3030"),g.on("TEAM_ADD_RESPONSE",d=>{if(d.To.id!==(r==null?void 0:r.id))return;o([d,...t]);const x=new Audio("/bell.mp3");x.muted=!0,x.play()})},[g]);const f=(d,x,k)=>{p.mutateAsync(d,{onSuccess:y=>{o(t.filter(P=>P.id!==y.id)),w(k==="Accepted"?"Invitation Accepted":"Invitation Rejected")}}),h.mutateAsync({pid:x,status:k})};return e.jsxs(be,{children:[e.jsx(we,{children:e.jsx(je,{icon:e.jsx(tt,{}),bg:"primary.900",children:(t==null?void 0:t.some(d=>!d.read))&&e.jsx(Pe,{boxSize:"1em",bg:"red.500",borderColor:"primary.900"})})}),e.jsx(Se,{bg:"primary.800",border:"none",width:"400px",maxHeight:"350px",height:"350px",children:e.jsxs(c,{padding:"10px",flexDir:"column",gap:"3",children:[e.jsx(m,{color:"primary.200",fontSize:"sm",children:"Notifications"}),e.jsx(rt,{}),(t==null?void 0:t.length)>0?t.slice(0,5).map((d,x)=>!d.read&&e.jsx(At,{notification:d,updateNotification:f},x)):e.jsx(c,{height:"200px",align:"center",justify:"center",children:e.jsx(m,{color:"primary.200",children:"No New Notification"})})]})})]})}function At({updateNotification:r,notification:t,props:o}){return e.jsx(c,{...o,flexDir:"column",padding:"10px",rounded:"10",gap:"2",bg:"primary.700",children:e.jsxs(c,{gap:"2",align:"center",children:[e.jsxs(m,{fontSize:"sm",children:[t.message,e.jsx(m,{color:"primary.200",children:et(t.createdAt).fromNow()})]}),e.jsx(ee,{}),e.jsx(ie,{size:"sm",icon:e.jsx(ot,{}),"aria-label":"tick",variant:"outline",color:"green.500",_hover:{bg:"green.500",color:"white"},onClick:()=>r(t.id,t.target_id,"Accepted")}),e.jsx(ie,{size:"sm",icon:e.jsx(Et,{}),"aria-label":"tick",variant:"outline",color:"red.500",_hover:{bg:"red.500",color:"white"},onClick:()=>r(t.id,t.target_id,"Rejected")})]})})}function Mt(r){return ye({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"}}]})(r)}function Ft({user:r,logout:t}){return e.jsxs(be,{offset:[30,20],children:[e.jsx(we,{children:e.jsx(je,{bg:"primary.100",color:"black",name:r==null?void 0:r.username,width:10,height:10})}),e.jsxs(Se,{bg:"primary.700",border:"none",children:[e.jsxs(c,{margin:"10px",gap:"2",children:[e.jsxs(m,{color:"primary.300",fontSize:"sm",children:["Signed in as:"," "]}),e.jsx(m,{color:"primary.100",fontSize:"sm",fontWeight:"bold",children:r==null?void 0:r.username})]}),e.jsx(Te,{color:"brand.200"}),e.jsx(ae,{color:"primary.100",bg:"primary.700",_hover:{bg:"brand.500"},icon:e.jsx(Mt,{size:"20"}),children:"Setttings"}),e.jsx(ae,{color:"primary.100",_hover:{bg:"brand.500"},bg:"primary.700",icon:e.jsx(st,{size:"20"}),onClick:t,children:"Log Out"})]})]})}function Rt({children:r}){const{successToast:t}=J(),o=he(l=>l.user),s=pe(),i=()=>{localStorage.removeItem("token"),s("/login"),t("Logged out successfully!")};return e.jsxs(c,{direction:"column",width:"full",maxHeight:"100vh",overflowY:"auto",children:[e.jsx(H,{bgColor:"primary.800",height:"60px",padding:"10px",children:e.jsxs(c,{align:"center",gap:"5",children:[Ot.map((l,p)=>e.jsx(V,{to:l.path,children:e.jsx(m,{fontSize:"sm",fontWeight:"bold",_hover:{color:"primary.200"},children:l.name})},p)),e.jsx(ee,{}),e.jsxs(c,{marginRight:10,align:"center",gap:"3",children:[e.jsx(It,{user:o}),e.jsx(Ft,{user:o,logout:i})]})]})}),r]})}function Bt({}){const{isLoading:r,data:t,isError:o}=ut();return e.jsx(ge,{spacing:3,children:r?e.jsx(Ce,{height:"20px"}):!o&&t.length>0?t==null?void 0:t.map(s=>e.jsx(me,{fontWeight:"bold",_hover:{color:"purple.300"},children:e.jsx(V,{to:`/project/${s.id}`,children:e.jsx(te,{label:s.title,placement:"right",children:e.jsxs(c,{align:"center",gap:"2",children:[e.jsx(fe,{as:nt}),e.jsx(m,{fontSize:"sm",_hover:{color:"purple.300"},children:s.title})]})})})},s.id)):e.jsx(ve,{message:"Create new projects to get started"})})}const Wt={0:{color:"gray.300",title:"Low"},1:{color:"orange.300",title:"High"},2:{color:"red.300",title:"Critical"}};function $t({bugList:r}){return e.jsx(ge,{spacing:3,children:r.map(t=>e.jsx(me,{fontWeight:"bold",children:e.jsx(V,{to:`/bugs/${t.id}`,children:e.jsxs(c,{align:"center",children:[e.jsx(fe,{as:it,color:Wt[t.priority].color}),e.jsx(te,{label:t.title,placement:"right",children:e.jsxs(m,{_hover:{color:"purple.300"},fontSize:"sm",children:["#",t.id,"/",t.title.length>25?`${t.title.slice(0,24)}..`:t.title]})})]})})},t.id))})}function Ht({isOpen:r,onClose:t}){const{mutateAsync:o,isLoading:s,isSuccess:i,isError:l}=pt(),p={title:"",description:""},{successToast:h,errorToast:g}=J();function w(f,{setSubmitting:d}){o(f),i&&(h(`Project ${f.title} created successfully`),d(!1)),l&&g("Something went wrong!"),t()}return e.jsx(Ge,{isOpen:r,onClose:t,header:"Create New Project",children:e.jsx(mt,{initialValues:p,onSubmit:w,validationSchema:ft({title:le().required("Project name is required"),description:le().required("Project description is required")}),children:({isSubmitting:f})=>e.jsx(xt,{children:e.jsxs(c,{flexDirection:"column",gap:"5",children:[e.jsx(jt,{type:"text",name:"title",label:"Project Name",width:"600px",placeholder:"Enter project name"}),e.jsx(dt,{name:"description",label:"Project Description",placeholder:"Enter short project description"}),e.jsx(ke,{disabled:s,type:"submit",colorScheme:"brand",fontSize:"md",size:"md",children:"Submit"})]})})})})}function Qt({}){const r=Ye(),{data:t,isLoading:o,isError:s}=Ke();return e.jsxs(e.Fragment,{children:[e.jsx(Ht,{onClose:r.onClose,isOpen:r.isOpen}),e.jsxs(c,{flexDirection:"column",width:"400px",bgColor:"primary.800",height:"100vh",padding:"20px",overflow:"hidden",children:[e.jsx(V,{to:"/",children:e.jsxs(c,{justifyContent:"center",alignItems:"center",children:[e.jsx(H,{boxSize:"30px",marginRight:"20px",children:e.jsx(vt,{src:"/LogoNoBack.png",alt:"logo"})}),e.jsx(m,{color:"primary.100",fontWeight:"extrabold",fontSize:"2xl",letterSpacing:"4px",children:"BUGNET"})]})}),e.jsxs(c,{marginTop:"50px",gap:"5",flexDir:"column",children:[e.jsx(m,{fontWeight:"bold",color:"primary.200",children:"Assigned Bugs"}),e.jsx(ce,{placeholder:"Search Bugs"}),e.jsx(H,{overflowY:"auto",overflowX:"hidden",padding:"5px",height:"300px",maxHeight:"300px",children:o?e.jsx(ht,{children:e.jsx(Ce,{height:"20px"})}):!s&&(t==null?void 0:t.length)>0?e.jsx($t,{bugList:t}):e.jsx(ve,{message:"No Bugs assigned to you yet!"})})]}),e.jsxs(c,{marginTop:"50px",gap:"5",flexDir:"column",children:[e.jsxs(c,{justify:"space-between",align:"center",children:[e.jsx(m,{fontWeight:"bold",color:"primary.200",children:"Projects"}),e.jsx(ke,{leftIcon:e.jsx(at,{}),colorScheme:"brand",fontSize:"sm",size:"sm",onClick:r.onOpen,children:"Create New"})]}),e.jsx(ce,{placeholder:"Search Projects"}),e.jsx(H,{overflowY:"auto",overflowX:"hidden",padding:"5px",maxHeight:"300px",children:e.jsx(Bt,{})})]})]})]})}function Vt({}){return e.jsx(e.Fragment,{children:e.jsxs(c,{children:[e.jsx(Qt,{}),e.jsx(Rt,{children:e.jsx(Qe,{})})]})})}function qt(r,t){if(Object.is(r,t))return!0;if(typeof r!="object"||r===null||typeof t!="object"||t===null)return!1;if(r instanceof Map&&t instanceof Map){if(r.size!==t.size)return!1;for(const[s,i]of r)if(!Object.is(i,t.get(s)))return!1;return!0}if(r instanceof Set&&t instanceof Set){if(r.size!==t.size)return!1;for(const s of r)if(!t.has(s))return!1;return!0}const o=Object.keys(r);if(o.length!==Object.keys(t).length)return!1;for(let s=0;s<o.length;s++)if(!Object.prototype.hasOwnProperty.call(t,o[s])||!Object.is(r[o[s]],t[o[s]]))return!1;return!0}function ar({}){const r=he(h=>h.setUser,qt),t=pe(),{data:o,isLoading:s,isError:i,isSuccess:l,error:p}=Nt();return i&&console.log(p.response.message),l&&((o==null?void 0:o.status)===401?(localStorage.removeItem("token"),t("/login")):r(o)),s?e.jsx(Ve,{}):e.jsx(Vt,{})}export{ar as default};
